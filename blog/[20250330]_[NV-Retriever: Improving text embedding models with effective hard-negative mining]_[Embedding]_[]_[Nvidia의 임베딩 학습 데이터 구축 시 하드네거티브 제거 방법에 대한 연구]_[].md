
# NV-Retriever: Improving text embedding models with effective hard-negative mining

https://arxiv.org/html/2407.15831v2


## 1. ê°œìš”

**ë“¤ì–´ê°€ê¸° ì „ ìš©ì–´ ê°„ë‹¨ ì •ë¦¬**

| ìš©ì–´ | ì„¤ëª… |
| --- | --- |
| Contrastive Learning | Queryì™€ Positiveë¥¼ ê°€ê¹ê²Œ, NegativeëŠ” ë©€ê²Œ í•™ìŠµí•˜ëŠ” ë°©ì‹ |
| Hard-Negative | Queryì™€ ë¹„ìŠ·í•˜ì§€ë§Œ ì‹¤ì œ ì •ë‹µì€ ì•„ë‹Œ ë¬¸ì„œ. í•™ìŠµ ë‚œì´ë„ â†‘ |
| False Negative | ì‹¤ì œë¡œëŠ” ì •ë‹µì¸ë° Negativeë¡œ ì˜ëª» ë¶„ë¥˜ëœ ê²½ìš° |
| Positive-aware Mining | Positive ì ìˆ˜ë¥¼ ê¸°ì¤€ìœ¼ë¡œ ì˜ëª»ëœ Negativeë¥¼ ì œê±°í•˜ëŠ” ë°©ë²• |

### 1.1 ì´ ë…¼ë¬¸ì˜ ì£¼ëœ ì—°êµ¬ ë‚´ìš©

- ì„ë² ë”© ëª¨ë¸ì€ ë³´í†µ **Contrastive Learning** ë°©ì‹ìœ¼ë¡œ í•™ìŠµë˜ë©°, ì´ë•Œ **Hard-Negative ìƒ˜í”Œ ì„ íƒ**ì´ ì„±ëŠ¥ í–¥ìƒì— ë§¤ìš° ì¤‘ìš”
- ë³¸ ë…¼ë¬¸ì€ íš¨ê³¼ì ì¸ **Hard-Negative ìƒ˜í”Œ ì„ íƒ ë°©ë²•ì— ëŒ€í•œ ì—°êµ¬ ë…¼ë¬¸**

---

### 1.2 ê¸°ì¡´ ë¬¸ì œì 

- ê¸°ì¡´ ì—°êµ¬ì—ì„œëŠ” **Hard-Negative Mining ê¸°ë²• ìì²´ì— ëŒ€í•œ ë¶„ì„ì´ë‚˜ ì„¤ëª…ì€ ë¶€ì¡±**í–ˆìŠµë‹ˆë‹¤.
- **Hard-Negative ìƒ˜í”Œë§ ì‹œ** ì˜ëª»ëœ Negative (ì‚¬ì‹¤ì€ Positiveì¸ ìƒ˜í”Œ)ê°€ ë“¤ì–´ê°ˆ ê²½ìš° í•™ìŠµì„ ë°©í•´í•  ìˆ˜ ìˆìŒ.

---

### 1.3 ì£¼ìš” ê¸°ì—¬ (ë…¼ë¬¸ì˜ í•µì‹¬ Contribution)

### (1) **Positive-aware Hard-negative Mining** ê¸°ë²• ì œì•ˆ

â†’ Positiveì˜ ìœ ì‚¬ë„ ì ìˆ˜ë¥¼ ê¸°ì¤€(anchor)ìœ¼ë¡œ ì‚¼ì•„ **False Negativeë¥¼ ì œê±°**í•˜ê³ , contrastive learning íš¨ìœ¨ì„ ë†’ì´ëŠ” ë°©ë²• ì œì•ˆ

### (2) **Hard-negative Mining ê¸°ë²•ì— ëŒ€í•œ êµ¬ì„±ë³„ ë¹„êµ ì—°êµ¬**

â†’ Teacher ëª¨ë¸, base ëª¨ë¸ ì¡°í•©ì„ ë‹¤ì–‘í•˜ê²Œ ë°”ê¾¸ë©° ì–´ë–¤ ë°©ì‹ì´ íš¨ê³¼ì ì¸ì§€ **ablation study** ìˆ˜í–‰

### (3) **ëŒ€ê·œëª¨ ì„±ëŠ¥ ê²€ì¦: NV-Retriever-v1**

â†’ ì œì•ˆ ê¸°ë²•ì„ ì‹¤ì œë¡œ ì ìš©í•´ **MTEB Retrieval ë²¤ì¹˜ë§ˆí¬ 1ìœ„ ëª¨ë¸(NV-Retriever-v1)** ê°œë°œ

â†’ í•´ë‹¹ ëª¨ë¸ì€ **BEIR ê¸°ì¤€ ì ìˆ˜ 60.9**ë¡œ ìµœê³  ì„±ëŠ¥ ê¸°ë¡ (2024ë…„ 7ì›”)

---

## 2. Background


### 2.1 Text Embedding Models

**í…ìŠ¤íŠ¸ ì„ë² ë”© ëª¨ë¸ì´ë€?**

â†’ ë‹¤ì–‘í•œ ê¸¸ì´ì˜ í…ìŠ¤íŠ¸ë¥¼ ê³ ì •ëœ ì°¨ì›ì˜ ë²¡í„°ë¡œ ë°”ê¿”ì£¼ëŠ” ëª¨ë¸. ê²€ìƒ‰, ì¶”ì²œ, ì˜ë¯¸ ìœ ì‚¬ë„ ë“± ë‹¤ì–‘í•œ ì‘ì—…ì— ì‚¬ìš©ë¨.

### ğŸ”¹ ì£¼ìš” ë°œì „ íë¦„:

- **Sentence-BERT (2019)**
    
    â†’ BERT ê¸°ë°˜ ìŒ(pair) ì…ë ¥ êµ¬ì¡° (Siamese/Triplet Network)ë¡œ ë¬¸ì¥ì„ ë²¡í„° ê³µê°„ì— íˆ¬ì˜
    
    â†’ ë‹¤ì–‘í•œ pooling, loss í•¨ìˆ˜ ì‹¤í—˜
    
- **DPR (2020)**
    
    â†’ Queryì™€ Passageë¥¼ ê°ê° ë³„ë„ BERTë¡œ ì²˜ë¦¬í•˜ëŠ” Bi-Encoder êµ¬ì¡° ì œì•ˆ
    
    â†’ CL ê¸°ë°˜ìœ¼ë¡œ í•™ìŠµ
    
- **E5 ì‹œë¦¬ì¦ˆ (2022)**
    
    â†’ Pre-training(ë¹„ì§€ë„) â†’ Fine-tuning(ì§€ë„) ë‘ ë‹¨ê³„ êµ¬ì„±
    
    â†’ ì—¬ê¸°ì„œ Pre-trainingì€ Masked Language Modelingì´ ì•„ë‹Œ Contrastive Pre-trainingìœ¼ë¡œ ì œëª©, ë¬¸ì„œ ìŒ ê°„ì˜ ìœ ì‚¬ë„ í•™ìŠµì„ ì˜ë¯¸ 
    
    â†’ ì§ˆë¬¸, ë¬¸ì„œ ìŒì˜ Retrieval Task ì„±ëŠ¥ì„ ë†’ì´ëŠ”ë° ì œëª©, ë¬¸ì„œ ìŒì˜ ìœ ì‚¬ë„ë¥¼ í•™ìŠµí•˜ëŠ” ì´ìœ  : ì§ˆë¬¸, ë¬¸ì„œ ìŒì˜ ë°ì´í„°ëŠ” ë¼ë²¨ë§ëœ ë°ì´í„°ë¡œ ë°ì´í„°ì˜ ê°œìˆ˜ê°€ ë§ì§€ ì•Šê¸° ë•Œë¬¸ì— ë¹„êµì  ê°œìˆ˜ê°€ ë§ê³  ê´‘ë²”ìœ„ì˜ ë°ì´í„°ì¸ ì œëª©, ë¬¸ì„œ ìŒì˜ ë°ì´í„°ë¥¼  ë¨¼ì € í•™ìŠµ
    
    â†’ Contrastive Pre-training ì˜ ë‹¨ì  : ê´‘ë²”ìœ„í•œ ë°ì´í„°ë¥¼ ìˆ˜ì§‘í•´ì•¼ í•˜ê¸° ë•Œë¬¸ì— ë°ì´í„° ìˆ˜ì§‘ì˜ ì–´ë ¤ì›€ê³¼ í•™ìŠµí•  ë°ì´í„°ì˜ ì–‘ì´ ë§ê¸° ë•Œë¬¸ì— ì†Œìš”ë˜ëŠ” ì»´í“¨íŒ… ë¦¬ì†ŒìŠ¤ë„ í¬ë‹¤ëŠ” ë‹¨ì  ì¡´ì¬
    
- **E5-Mistral (2023)**
    
    â†’ Encoder(BERT) ëŒ€ì‹  **Decoder ê¸°ë°˜ LLM(Mistral-7B)** ì‚¬ìš©
    
    â†’ ë‹¤ì–‘í•œ ì–¸ì–´/íƒœìŠ¤í¬ì˜ synthetic dataë¡œ 1íšŒë§Œ fine-tuning
    
    â†’ 1íšŒ fine-tuningì´ ê°–ëŠ” ì˜ë¯¸ : Encoder ëª¨ë¸ì˜ ê²½ìš° ë³´í†µ (Contrastive) Pre-training(ë¹„ì§€ë„) â†’ Fine-tuning(ì§€ë„) ë‘ ë‹¨ê³„ êµ¬ì„±ë˜ëŠ”ë° ë˜ê³  Pre-trainingì˜ ê²½ìš° ë§ì€ ì»´í“¨íŒ… ë¦¬ì†ŒìŠ¤ê°€ í•„ìš”í•œë° ì´ ë¶€ë¶„ì„ ìƒëµí•  ìˆ˜ ìˆìŒ
    
    â†’ (Contrastive) Pre-trainingì„ ìƒëµí•´ë„ ë˜ëŠ” ì´ìœ  : LLM ëª¨ë¸ì˜ ê²½ìš° Encoder ëª¨ë¸ ë³´ë‹¤ ë” ê´‘ë²”ìœ„í•˜ê³  ë§ì€ ë°ì´í„°ë¡œ ì‚¬ì „ í•™ìŠµ ë˜ì—ˆê¸° ë•Œë¬¸ì— í•´ë‹¹ ë‹¨ê³„ë¥¼ ìƒëµí•˜ê³  Fine-tuning ë§Œ í•´ë„ ì„±ëŠ¥ì´ ë†’ê²Œ ë‚˜ì˜¬ ìˆ˜ ìˆìŒ
    
- **Gemini Embedding (2025)**
    
    â†’ ì´ ë…¼ë¬¸ ì´í›„ì— ë‚˜ì˜¨ ëª¨ë¸ì´ì§€ë§Œ **E5-Mistral** ë°©ì‹ê³¼ ë‹¤ë¥¸ ë¶€ë¶„ ì†Œê°œ : LLM ëª¨ë¸ì„ base ëª¨ë¸ ì‚¬ìš© ì‹œ ìƒëµëœ Pre-training ë‹¨ê³„ë¥¼ ì‚¬ìš©
    
    â†’ Pre-training ë‹¨ê³„ë¥¼ ì‚¬ìš©í•˜ëŠ” ì´ìœ  : Pre-training ë‹¨ê³„ì—ì„œ autoregressive generationì„ encodingìœ¼ë¡œ ë§¤ê°œë³€ìˆ˜ ì¡°ì •ì˜ ëª©ì ì´ ìˆë‹¤.
    

### ğŸ”¹ í‰ê°€ ë²¤ì¹˜ë§ˆí¬:

- **BEIR (2021)**
    
    â†’ 18ê°œ retrieval taskë¡œ êµ¬ì„±, zero-shot í‰ê°€ ëª©ì 
    
- **MTEB (2022)**
    
    â†’ BEIR + ë¶„ë¥˜, í´ëŸ¬ìŠ¤í„°ë§ ë“± ì´ 56ê°œ taskë¡œ í™•ì¥
    
    â†’ Retrieval taskëŠ” BEIR ì¤‘ 15ê°œë¥¼ í¬í•¨
    

---

### 2.2 Hard-Negative Mining for Fine-tuning

Contrastive Learningì—ì„œëŠ” (query, positive, negative)ì˜ **triplet**ì´ í•„ìš”

â†’ ì´ë•Œ â€œnegativeâ€ê°€ **ì–¼ë§ˆë‚˜ ì–´ë ¤ìš´(hard)** ìƒ˜í”Œì´ëƒê°€ í•™ìŠµ í’ˆì§ˆì— í° ì˜í–¥ì„ ì¤Œ

### ğŸ”¹ Negative ìƒ˜í”Œë§ ë°©ì‹

- **In-Batch Negative**
    
    â†’ ê°™ì€ ë°°ì¹˜ ë‚´ ë‹¤ë¥¸ ì¿¼ë¦¬ì˜ Positiveë¥¼ Negativeë¡œ í™œìš©
    
    â†’ íš¨ìœ¨ì ì´ì§€ë§Œ ëŒ€ë¶€ë¶„ ë¬´ê´€í•œ í…ìŠ¤íŠ¸ë¼ì„œ **ë„ˆë¬´ ì‰¬ìš´ negative**ê°€ ë¨ â†’ í•™ìŠµ íš¨ê³¼ ë‚®ìŒ
    
- **Memory Bank / Cross-Batch (Xiong et al., 2020)**
    
    â†’ ê³¼ê±° ë°°ì¹˜ì˜ embeddingì„ ëª¨ì•„ë‘ê±°ë‚˜ ì—¬ëŸ¬ GPU ë°°ì¹˜ ê³µìœ 
    
- **Hard Negative Mining**
    
    â†’ ì‹¤ì œ queryì™€ ë¹„ìŠ·í•˜ì§€ë§Œ ì •ë‹µì´ ì•„ë‹Œ ë¬¸ì„œë¥¼ ì°¾ì•„ negativeë¡œ í™œìš©
    
    â†’ BM25ë‚˜ embedding ê¸°ë°˜ retrieval ëª¨ë¸ë¡œ ë½‘ìŒ
    
    â†’ DPRë„ BM25ë¡œ hard-negativeë¥¼ ë¯¸ë¦¬ ë½‘ì•„ì„œ ì‚¬ìš©
    

---

### ğŸ” False Negatives ë¬¸ì œ

> â€œQueryì™€ ë§¤ìš° ìœ ì‚¬í•œ ë¬¸ì„œ ì¤‘ ì¼ë¶€ëŠ” ì‹¤ì œë¡œ Positiveì¼ ìˆ˜ë„ ìˆë‹¤.â€
> 
- MS MARCO ì‹¤í—˜ì— ë”°ë¥´ë©´, ê°€ì¥ ìœ ì‚¬í•œ 100ê°œ ì¤‘ **70%ê°€ ì‹¤ì œ Positive**ì¼ ê°€ëŠ¥ì„±ì´ ìˆìŒ (Qu et al., 2020)
    
    â†’ ì´ë¥¼ ëª¨ë¥´ê³  negativeë¡œ ë„£ìœ¼ë©´ ëª¨ë¸ í˜¼ë€
    
    â†’ í•´ê²°: ìœ ì‚¬ë„ ì ìˆ˜ê°€ ë†’ì€ ë¬¸ì„œëŠ” ì œê±°í•˜ê±°ë‚˜ denoise
    

### ê¸°ì¡´ì˜ í•´ê²°ë²•

- **Cross-Encoderë¡œ í•„í„°ë§** (RocketQA ë“±)
- **LLMìœ¼ë¡œ relevance score íŒë‹¨**
- ë¬¸ì œ: ëŒ€ê·œëª¨ ë°ì´í„°ì— ì“°ê¸°ì—” ë¹„ìš© í¼ (ëª¨ë“  ì¿¼ë¦¬-ë¬¸ì„œ ìŒì— ëŒ€í•´ ì¶”ë¡  í•„ìš”)
- **Snowflake-arctic-embed-l**: threshold ì¡°ì ˆ (e.g. ì ìˆ˜ 0.4, 0.5, 0.8) ì‹¤í—˜

### ì´ ë…¼ë¬¸ì„ ì½ê¸° ì „ ë‚˜ì˜ í•´ê²°ë²•

- **Snowflake ë…¼ë¬¸(**https://arxiv.org/html/2405.05374v1)**ì„ ì°¸ê³ (ë¶€ë¡ ë¶€ë¶„)**í•˜ì—¬ Retriever ëª¨ë¸ì˜ threshold ì¡°ì ˆ (e.g. ì ìˆ˜ 0.4, 0.5, 0.8)ì„ í†µí•œ í•„í„°ë§
- ì´ ë…¼ë¬¸ì—ì„œ ë§í•˜ëŠ” ê¸°ì¡´ì˜ ë°©ë²•ë“¤ì„ ì‚¬ìš©

---

## 3. Methodology


### **3.1 Positive-aware Hard-negative Mining Methods**

### ğŸ”¸ ë°°ê²½ ìš”ì•½

- Contrastive Learningì—ì„œëŠ” queryì™€ positiveë¥¼ ê°€ê¹ê²Œ, negativeëŠ” ë©€ê²Œ ë§Œë“¤ë„ë¡ í•™ìŠµí•¨.
- ì¼ë°˜ì ìœ¼ë¡œ **Top-K ê°€ì¥ ìœ ì‚¬í•œ ë¬¸ì„œë“¤**ì„ negativeë¡œ ì„ íƒí•˜ëŠ”ë°, ì´ ë°©ì‹ì€ **False Negative(ì‹¤ì œë¡œëŠ” ì •ë‹µì¸ë° labelì´ ì—†ìŒ)**ë¥¼ í¬í•¨í•  ìœ„í—˜ì´ í¼.

### ğŸ”¸ ê¸°ì¡´ ë°©ë²•ë“¤ ìš”ì•½

| ê¸°ë²• | ì„¤ëª… | í•œê³„ |
| --- | --- | --- |
| Top-K shifted by N | ìƒìœ„ Nê°œëŠ” ë¬´ì‹œí•˜ê³  ê·¸ ì´í›„ Kê°œë¥¼ ì‚¬ìš© | relevance ì ìˆ˜ ë¬´ì‹œ, ì¢‹ì€ negativeë¥¼ ë²„ë¦´ ìˆ˜ë„ ìˆìŒ |
| TopK-Abs | ì ˆëŒ€ ì ìˆ˜ ê¸°ì¤€(threshold ì´ìƒì€ ì œê±°) | positiveì˜ ì ìˆ˜ë¥¼ ê³ ë ¤í•˜ì§€ ì•ŠìŒ |

---

### ğŸŒŸ **ì €ìë“¤ì˜ ì œì•ˆ: Positive-aware Mining**

â†’ **Positive passageì˜ ìœ ì‚¬ë„ ì ìˆ˜(`sim(q, dâº)`)ë¥¼ ê¸°ì¤€(anchor)**ìœ¼ë¡œ í™œìš©í•´

False Negative ê°€ëŠ¥ì„±ì´ ë†’ì€ negativeë¥¼ ì œê±°í•˜ëŠ” ë°©ì‹

### í•µì‹¬ ì•„ì´ë””ì–´:

> â€œPositive ì ìˆ˜ë³´ë‹¤ ë„ˆë¬´ ìœ ì‚¬í•œ NegativeëŠ” False Negativeì¼ ìˆ˜ ìˆìœ¼ë‹ˆ ì œì™¸í•˜ì.â€
> 

---

### ğŸ”§ ì œì•ˆëœ ë‘ ê°€ì§€ í•„í„° ë°©ì‹:

| ë°©ë²• | ì„¤ëª… | ìœ ì‚¬ë„ ì„ê³„ê°’ ê¸°ì¤€ |
| --- | --- | --- |
| **TopK-MarginPos** | `Negative < Positive - margin` | ì ˆëŒ€ê°’ margin (ì˜ˆ: 0.2 ì´ìƒ ì°¨ì´) |
| **TopK-PercPos** | `Negative < Positive * percentage` | ë¹„ìœ¨ margin (ì˜ˆ: 90% ì´í•˜ë©´ í†µê³¼) |

### ğŸ“Œ ì•Œê³ ë¦¬ì¦˜ êµ¬ì¡° (ì˜ì‚¬ ì½”ë“œ í˜•íƒœ)

```python
# q : query, p : positive, n : negative
for n in top_k_negatives:
    if sim(n, q) < sim(p, q) - margin:  # TopK-MarginPos
        keep n
```

â†’ ë˜ëŠ” `sim(n, q) < sim(p, q) * 0.9` (TopK-PercPos)

### ì¥ì 

- Positive scoreë¥¼ ê¸°ì¤€ìœ¼ë¡œ false negativeë¥¼ ê±¸ëŸ¬ë‚¼ ìˆ˜ ìˆìŒ

---

### **3.2 Research Questions**

ì´ ë…¼ë¬¸ì€ ì•„ë˜ ì„¸ ê°€ì§€ ì—°êµ¬ ì§ˆë¬¸(RQ)ì„ ì‹¤í—˜ì„ í†µí•´ ê²€ì¦í•©ë‹ˆë‹¤:

| RQ | ë‚´ìš© |
| --- | --- |
| RQ1 | ì„œë¡œ ë‹¤ë¥¸ **teacher ëª¨ë¸**ë¡œ hard-negativeë¥¼ miningí•  ë•Œ downstream ì„±ëŠ¥ ì°¨ì´ê°€ ì–¼ë§ˆë‚˜ ë‚˜ëŠ”ê°€? |
| RQ2 | ì„œë¡œ ë‹¤ë¥¸ teacherì—ì„œ miningí•œ hard-negativesë¥¼ **ensemble**í•˜ë©´ ë” ì¢‹ì€ê°€? |
| RQ3 | ì„œë¡œ ë‹¤ë¥¸ **hard-negative mining ë°©ë²•**(Naive Top-K vs Positive-aware ë“±)ì˜ ë¹„êµ |

---

### 3.3 **Experiments Setup**

### 3.3.1 Training

- Base model: `e5-large-unsupervised` ë˜ëŠ” `Mistral-7B-v0.1`
- í•™ìŠµ ë°ì´í„°ì…‹ (ì´ 287k ì¿¼ë¦¬):
    - Natural Questions (NQ)
    - StackExchange (2023 ë¤í”„)
    - SQuAD

### 3.3.2 Evaluation

- í‰ê°€ ë°ì´í„°ì…‹ (BEIR / MTEB ì¤‘ ì¼ë¶€):
    - NQ
    - HotpotQA
    - FiQA-2018
        
        â†’ ì´ 3ê°€ì§€ëŠ” **Q&A + RAG í™˜ê²½**ì— ê°€ì¥ ë°€ì ‘í•œ íƒœìŠ¤í¬ì„
        
- RQ3 ì‹¤í—˜ì—ì„œëŠ” **NV-Retriever-v1**ì˜ ì „ì²´ í•™ìŠµ ë°ì´í„°ë¡œ ìŠ¤ì¼€ì¼ í™•ì¥ ì‹¤í—˜ë„ ì§„í–‰

---

## 4. ì‹¤í—˜ ê²°ê³¼ ë° í•´ì„ ìš”ì•½


### **4.1 RQ1: ì„œë¡œ ë‹¤ë¥¸ teacher modelë¡œ miningí•  ê²½ìš° ê²°ê³¼ëŠ”?**

### ğŸ” ì‹¤í—˜ ê°œìš”

- ë™ì¼í•œ base ëª¨ë¸: `e5-large-unsupervised`
- ë™ì¼í•œ í•™ìŠµ ë°ì´í„°ì…‹ì— ëŒ€í•´ **ì„œë¡œ ë‹¤ë¥¸ teacher ëª¨ë¸**ì„ ì‚¬ìš©í•´ hard-negative 4ê°œì”© mining
- ê·¸ ê²°ê³¼ë¥¼ ê°€ì§€ê³  base ëª¨ë¸ì„ fine-tune â†’ ì„±ëŠ¥ ë¹„êµ (NDCG@10 ê¸°ì¤€)

### ğŸ§  ì‚¬ìš©ëœ teacher ëª¨ë¸ë“¤:

| ëª¨ë¸ëª… | íŠ¹ì§• |
| --- | --- |
| **BM25** | Sparse baseline (ê°€ì¥ ê¸°ë³¸ì ì¸ ê²€ìƒ‰ ë°©ì‹) |
| **e5-large-unsupervised** | ë¹„ì§€ë„ í•™ìŠµë§Œ ëœ Dense ëª¨ë¸ |
| **e5-large-v2** | ì§€ë„ í•™ìŠµ í¬í•¨ëœ E5 ê°œì„  ë²„ì „ |
| **snowflake-arctic-embed-l** | E5ì™€ ìœ ì‚¬í•˜ë‚˜ ë” ê°œì„ ëœ í•™ìŠµ ë°©ì‹ ì ìš© |
| **e5-mistral-7b-instruct** | Mistral ê¸°ë°˜ ë””ì½”ë” ëª¨ë¸ (7B) |
| **NV-Embed-v1** | Mistral + Bi-directional attention êµ¬ì¡° (7.8B) |

### ğŸ“Š ì‹¤í—˜ ê²°ê³¼ ìš”ì•½

- **BM25ë¡œ ë½‘ì€ í•˜ë“œë„¤ê±°í‹°ë¸Œê°€ ê°€ì¥ ì„±ëŠ¥ì´ ë‚®ìŒ**
    
    â†’ ê¸°ì¡´ ì—°êµ¬(Karpukhin et al., 2020)ì™€ ë°˜ëŒ€ ê²°ê³¼. ìµœì‹  dense ëª¨ë¸ì—ì„œëŠ” BM25 negativeê°€ ë” ì´ìƒ íš¨ê³¼ì ì´ì§€ ì•ŠìŒ.
    
- **ëª¨ë¸ ê·œëª¨ & fine-tuning ë°ì´í„° í’ˆì§ˆì´ ì¢‹ì„ìˆ˜ë¡ ë” ì¢‹ì€ hard-negative ìƒì„±**
    
    â†’ NV-Embed-v1, e5-mistral-7b-instruct â‰« ë‚˜ë¨¸ì§€ ì‘ì€ dense ëª¨ë¸ë“¤
    
- **ê²°ë¡ :**
    
    > ë” í° teacher + ë” ì¢‹ì€ í•™ìŠµ ë°ì´í„°ë¥¼ ê°€ì§„ ëª¨ë¸ì¼ìˆ˜ë¡ hard-negative miningì˜ ì§ˆì´ ë†’ì•„ì§„ë‹¤.
    > 
    
    â†’ ê°™ì€ ë§¥ë½ìœ¼ë¡œ gemini embedding ëª¨ë¸ë„ LLM ì„ ì‚¬ìš©í•´ì„œ hard-negative miningì„ ì§„í–‰
    

---

### **4.2 RQ2: ì—¬ëŸ¬ teacher modelì˜ hard-negativeë¥¼ ensembleí•˜ë©´ ë” ì¢‹ì„ê¹Œ?**

### ì‹¤í—˜ ë™ê¸°

- ì„œë¡œ ë‹¤ë¥¸ teacher ëª¨ë¸ë“¤ì´ ë½‘ì•„ë‚´ëŠ” hard-negativeê°€ **ê²¹ì¹˜ëŠ” ê²Œ ê±°ì˜ ì—†ìŒ (Jaccard ìœ ì‚¬ë„ < 30%)**
- â†’ ì„œë¡œ ë‹¤ë¥¸ ê´€ì ì—ì„œ ì¶”ì¶œëœ hard-negativeë¥¼ ì„ì–´ë³´ë©´ ì„±ëŠ¥ í–¥ìƒ ê°€ëŠ¥ì„± ìˆìŒ

### ğŸ” Ensemble ë°©ë²• ë‘ ê°€ì§€

| ë°©ë²• | ì„¤ëª… |
| --- | --- |
| **Cross-sample** | ê° ë°ì´í„° ìƒ˜í”Œë§ˆë‹¤ í•˜ë‚˜ì˜ teacherë¥¼ ëœë¤ìœ¼ë¡œ ì„ íƒí•´ì„œ 4ê°œ negativeë¥¼ ë°›ìŒ |
| **Intra-sample** | ê° ìƒ˜í”Œì— ëŒ€í•´ 4ê°œ teacher ëª¨ë¸ì—ì„œ ê°ê° top-1 negativeë¥¼ ì¶”ì¶œí•´ êµ¬ì„± |
- Intra-sampleì€ ì¤‘ë³µ ê°€ëŠ¥ â†’ ë‘ ë²„ì „ ì‹¤í—˜:
    - **dedup:** ì¤‘ë³µ ì œê±° + ë‹¤ìŒ ìˆœìœ„ negativeë¡œ ëŒ€ì²´
    - **no-dedup:** ì¤‘ë³µ ê·¸ëŒ€ë¡œ ì‚¬ìš©

### ğŸ“Š ê²°ê³¼ ìš”ì•½ (Table 2)

- **Cross-sample**: baselineë³´ë‹¤ ëª»í•¨ â†’ ì„±ëŠ¥ X
- **Intra-sample (dedup)**: baselineë³´ë‹¤ ì•½ê°„ í–¥ìƒ
- **Intra-sample (no-dedup)**: **ê°€ì¥ ì„±ëŠ¥ ìš°ìˆ˜**

### ğŸ” ì™œ no-dedupì´ ë” ì¢‹ì•˜ì„ê¹Œ?

> â€œë§Œì•½ ì—¬ëŸ¬ teacherê°€ ê°™ì€ ë¬¸ì„œë¥¼ hard-negativeë¡œ ì„ íƒí–ˆë‹¤ë©´,
> 
> 
> ê·¸ê±´ ì •ë§ ì¤‘ìš”í•œ hard-negativeì¼ ìˆ˜ ìˆìŒ.
> 
> ì¤‘ë³µìœ¼ë¡œ ë“±ì¥ì‹œí‚¤ë©´ contrastive lossì—ì„œ ë” í° weightë¥¼ ë°›ìœ¼ë¯€ë¡œ í•™ìŠµì— ê¸ì •ì .â€
> 

â†’ ì§ˆ ì¢‹ì€ í•˜ë“œ ë„¤ê±°í‹°ë¸Œì˜ ê²½ìš° ì¤‘ë³µí•˜ì—¬ ë„¤ê±°í‹°ë¸Œë¥¼ êµ¬ì„±í•˜ëŠ” ê²ƒì´ ê¸ì •ì ì¸ íš¨ê³¼ë¥¼ ì¤€ë‹¤.

## ğŸ§  ì´ ì„¹ì…˜ì—ì„œ ì–»ì„ ìˆ˜ ìˆëŠ” ì¸ì‚¬ì´íŠ¸

| í•µì‹¬ êµí›ˆ | ì„¤ëª… |
| --- | --- |
| ì¢‹ì€ hard-negativeëŠ” **ì¢‹ì€ teacher ëª¨ë¸ì´ ìˆì–´ì•¼** ê°€ëŠ¥ | dense, ëŒ€í˜• ëª¨ë¸ì´ ë” ì¢‹ì€ negativeë¥¼ ì°¾ì•„ëƒ„ |
| **Ensemble ì „ëµì€ ì‹ ì¤‘íˆ ì„¤ê³„ë˜ì–´ì•¼** í•¨ | ë‹¨ìˆœ ì¡°í•©ë³´ë‹¤, ì¤‘ë³µì„ ì „ëµì ìœ¼ë¡œ í™œìš©í•˜ëŠ” ë°©ì‹ì´ ë” ë‚˜ìŒ |
| **ì¤‘ë³µ hard-negativeê°€ ë°˜ë“œì‹œ ë‚˜ìœ ê±´ ì•„ë‹˜** | ì˜¤íˆë ¤ ëª¨ë¸ ê°„ í•©ì˜ì˜ í‘œì‹œë¡œ, ì¤‘ìš”í•œ í•™ìŠµ ì‹ í˜¸ê°€ ë  ìˆ˜ ìˆìŒ |

---

### **4.3** RQ3: Mining ë°©ë²•ë³„ ì„±ëŠ¥ ë¹„êµ

### ğŸ”¬ 4.3.1. Ablation ì‹¤í—˜ (ë§ˆì§„/ì„ê³„ê°’ ì„¤ì • ì‹¤í—˜)

| ë°©ë²• | ì‹¤í—˜ ì„¤ì • | ìµœì  ì„±ëŠ¥ ì¡°ê±´ | ì„±ëŠ¥ ìš”ì•½ |
| --- | --- | --- | --- |
| **Top-K Shifted by N** | ìƒìœ„ Nê°œë¥¼ ì œì™¸ | N=10ì¼ ë•Œ ê°€ì¥ ì¢‹ìŒ | ìƒìœ„ ë¬¸ì„œê°€ FNì¼ ê°€ëŠ¥ì„±ì´ ë†’ê¸° ë•Œë¬¸ |
| **TopK-Abs** | ì ìˆ˜ ì„ê³„ê°’ìœ¼ë¡œ í•„í„°ë§ | ìµœëŒ€ 0.7 ì´í•˜ê°€ ê°€ì¥ ì¢‹ìŒ | 0.7ë³´ë‹¤ ë†’ìœ¼ë©´ FN í¬í•¨ ìœ„í—˜, ë‚®ìœ¼ë©´ ì•½í•œ negativeë§Œ ë‚¨ìŒ |
| **TopK-MarginPos** | Positive ì ìˆ˜ - margin | margin=0.05ì¼ ë•Œ best | marginì´ ë„ˆë¬´ í¬ë©´ ì¢‹ì€ negativeë„ ì œê±°í•¨ |
| **TopK-PercPos** | Positive ì ìˆ˜ Ã— í¼ì„¼íŠ¸ | 95%ì¼ ë•Œ best | ê·¸ ì´ìƒì€ FN í¬í•¨ ê°€ëŠ¥ì„± â†‘ |

---

### ğŸ¯ 4.3.2. Sampling ì „ëµ

- **Sampled Top-K**: top-k ì¤‘ ë¬´ì‘ìœ„ ìƒ˜í”Œë§
- **Top-1 + Sampled**: ê°€ì¥ ìƒìœ„ 1ê°œëŠ” ê³ ì •í•˜ê³ , ë‚˜ë¨¸ì§€ëŠ” ë¬´ì‘ìœ„ ìƒ˜í”Œë§

### ì‹¤í—˜ ê²°ê³¼:

- `Top-1+Sampled` ë°©ì‹ì´ ë” ì•ˆì •ì 
- `k=10`ê¹Œì§€ë§Œ ì„±ëŠ¥ í–¥ìƒ, ê·¸ ì´ìƒì€ ì„±ëŠ¥ í•˜ë½
    - `top-k` ì¤‘ì—ì„œ **ë„¤ê±°í‹°ë¸Œ ìƒ˜í”Œì„ ë¬´ì‘ìœ„ë¡œ ë½‘ëŠ” ë°©ì‹**ì—ì„œëŠ”,
    
    â†’ `k=10` ì •ë„ê¹Œì§€ëŠ” ì„±ëŠ¥ì´ ì˜¬ë¼ê° (ì™œëƒí•˜ë©´ ìœ ì˜ë¯¸í•œ hard-negativeë“¤ì´ top 10 ì•ˆì— ë“¤ì–´ìˆê¸° ë•Œë¬¸)
    â†’ ê·¸ëŸ°ë° `k` ê°’ì„ **ë” í¬ê²Œ (ì˜ˆ: 30, 50, 100)** ì„¤ì •í•˜ë©´,
    
    - ëœ ê´€ë ¨ëœ, í•™ìŠµì— ë³„ë¡œ ë„ì›€ ì•ˆ ë˜ëŠ” ì‰¬ìš´ negativeë“¤ì´ ì„ì´ê²Œ ë˜ê³ 
    - ëª¨ë¸ì´ **í˜¼ë€ìŠ¤ëŸ½ê±°ë‚˜ ëœ íš¨ê³¼ì ì¸ í•™ìŠµ**ì„ í•˜ê²Œ ë˜ì–´ **ì„±ëŠ¥ì´ ì˜¤íˆë ¤ ë–¨ì–´ì§**

---

### ğŸ¥‡ 4.3.3. Mining ë°©ë²• ìµœì¢… ë¹„êµ (Base: e5-large-unsupervised, 334M)

| Mining Method | ìš”ì•½ | ê²°ê³¼ |
| --- | --- | --- |
| **Naive Top-K** | FN ì œê±° ì•ˆ í•¨ | ê°€ì¥ ë‚®ì€ ì„±ëŠ¥ |
| **Top-K Shifted** | ìƒìœ„ FN ì œê±° | ì„±ëŠ¥ ì¦ê°€ |
| **TopK-Abs** | ì ˆëŒ€ ì ìˆ˜ ê¸°ì¤€ í•„í„°ë§ | ë¬´ë‚œí•œ ì„±ëŠ¥ |
| **TopK-MarginPos** | Positive ì ìˆ˜ ê¸°ë°˜ margin | ğŸ”¼ ìƒìœ„ê¶Œ |
| **TopK-PercPos** | Positive Ã— í¼ì„¼íŠ¸ (95%) | âœ… **ìµœê³  ì„±ëŠ¥** |

â†’ **ê²°ë¡ :** Positive-aware ë°©ì‹ì´ **FN(False Negative)ì„ íš¨ìœ¨ì ìœ¼ë¡œ ì œê±°í•´ ê°€ì¥ íš¨ê³¼ì ì¸ contrastive í•™ìŠµì„ ìœ ë„**

![image.png](attachment:7251f01b-037d-40d6-9e8b-6272264cca83:image.png)

---

### ğŸ’ª 4.3.4. ëŒ€í˜• ëª¨ë¸(Mistral-7B-v0.1, 7.1B)ë¡œ ì¼ë°˜í™” ì‹¤í—˜

- ê° ì¿¼ë¦¬ë‹¹ **hard-negative 1ê°œ**ë§Œ ì‚¬ìš© (ë©”ëª¨ë¦¬ ì œí•œ)
- ì•ì„œ ì°¾ì€ best configë“¤ ê·¸ëŒ€ë¡œ ì‚¬ìš©
- **TopK-PercPos**ê°€ Mistralì—ì„œë„ **ìµœê³  ì„±ëŠ¥**

![image.png](attachment:9e51b286-431e-4b07-b857-94e15065c3f5:image.png)

---

### **4.4** RQ3b: NV-Retriever-v1 ê·œëª¨ë¡œ í™•ì¥ ì‹¤í—˜

### ì‹¤í—˜ ì¡°ê±´

- Base ëª¨ë¸: **Mistral-7B-v0.1**
- Teacher ëª¨ë¸: **E5-Mistral-7B**
- Train set: 15ê°œ BEIR Retrieval ë°ì´í„°ì…‹, ì´ **728,160 ì¿¼ë¦¬**
- ëª©ì : NV-Retriever-v1ê³¼ **ë™ì¼í•œ ì„¸íŒ…ìœ¼ë¡œ mining ë°©ë²• ë¹„êµ**

---

| Mining Method | Avg. NDCG@10 (15ê°œ ë°ì´í„°ì…‹) |
| --- | --- |
| **TopK-PercPos (95%)** | **60.55** â†’ ê±°ì˜ NV-Retriever-v1 ìˆ˜ì¤€ |
| **TopK-MarginPos** | 2ê°œ ë°ì´í„°ì…‹ì—ì„œ best |
| **ê¸°íƒ€ ë°©ë²•ë“¤** | ëª¨ë‘ ì„±ëŠ¥ ì—´ì„¸ (FN ì œê±° ë¶€ì¡±) |
- NV-Retriever-v1 (60.9ì )ëŠ” ì´í›„ classification/clustering íƒœìŠ¤í¬ê¹Œì§€ ì¶”ê°€ í•™ìŠµí•œ ê²°ê³¼
- ì¦‰, **TopK-PercPosë¡œë§Œ í•™ìŠµí•œ ëª¨ë¸ì´ ê±°ì˜ ë™ë“±í•œ ì„±ëŠ¥**ì„ ë³´ì„

---

## 5. ê²°ë¡ 

| í•­ëª© | ìš”ì•½ |
| --- | --- |
| ğŸ ê¸°ì—¬ | Positive-aware hard-negative mining ë°©ë²• ì œì•ˆ (TopK-MarginPos, TopK-PercPos) |
| ğŸ§ª ì‹¤í—˜ | Ablation + Teacher ëª¨ë¸ ë‹¤ì–‘í™” + Ensemble + ëŒ€í˜• ëª¨ë¸ ì ìš© + MTEB ì „ì²´ í‰ê°€ |
| ğŸ§  ë°œê²¬ | ëª¨ë¸ ì„±ëŠ¥ì€ mining ë°©ì‹ì— ë§¤ìš° ë¯¼ê°í•˜ë©°, false negativeë¥¼ ì œê±°í•˜ë©´ ì„±ëŠ¥ì´ í™•ì—°íˆ í–¥ìƒë¨ |
| ğŸ”¬ í™•ì¥ì„± | ì´ ë°©ë²•ì€ **multi-modal ëª¨ë¸ (ì˜ˆ: ì´ë¯¸ì§€+í…ìŠ¤íŠ¸)**ì—ë„ íš¨ê³¼ì ì¼ ê°€ëŠ¥ì„± ìˆìŒ |

---

## ğŸ”š ì´ ë…¼ë¬¸ì´ ë§í•˜ëŠ” ê¶ê·¹ì ì¸ ë©”ì‹œì§€

> ğŸ” â€œì¢‹ì€ ì„ë² ë”© ëª¨ë¸ì€ ë‹¨ìˆœíˆ ì¢‹ì€ ëª¨ë¸ êµ¬ì¡°ë§Œìœ¼ë¡œ ë§Œë“¤ì–´ì§€ì§€ ì•ŠëŠ”ë‹¤.
> 
> 
> í•™ìŠµì— ì“°ì´ëŠ” **Negative ìƒ˜í”Œì˜ â€˜ì§ˆâ€™**ì´ ì„±ëŠ¥ì„ ê²°ì •ì§“ëŠ” í•µì‹¬ì´ë©°,
> 
> ì´ë¥¼ ê°œì„ í•˜ëŠ” **Positive-aware mining**ì€ SOTAë¥¼ ë‹¬ì„±í•˜ëŠ” ë° í•„ìš”í•œ â€˜ìˆ¨ì€ ë¹„ê²°â€™ì´ë‹¤.â€
>
